<!DOCTYPE html>
<html lang="en">
<head>
    <title>ClickHouse: Present and Future</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="shower/themes/yandex/styles/screen-16x9.css">

    <style type="text/css">
         code { display: block; white-space: pre; background-color: #EEE; }
         p.cloud { text-align: center; line-height: 2; }
         p.cloud span { color: gray; padding: 0 20px 0 20px; white-space: nowrap; }
    </style>
</head>
<body class="shower list">
    <header class="caption">
        <h1>ClickHouse: Present and Future</h1>
    </header>
    <section class="slide" id="cover">
        <h1 style="margin-top: 80px; line-height: 150%; color: black; font-size: 48pt">ClickHouse:<br/>Present and Future</h1>
    </section>

<section class="slide">
<h2>I Will Tell You:</h2>
<p>— why ClickHouse is a good system;</p>
<p>— why ClickHouse is a bad system;</p>
<p>— and what to do about it.</p>
</section>


<section class="slide">
<p class="cloud" style="margin-top: 2em;">
<span>Impala</span>
<span>Spark SQL</span>
<span>Presto/Trino</span>
<span>Drill</span>
<span>Hawq</span>
<span>Actian Vortex</span>
<span>Kylin</span>
<span>Kudu</span>

<span>MonetDB</span>
<span>Vectorwise</span>
<span>Actian Vector</span>
<span>Actian Matrix</span>
<span>Redshift</span>
<span>Snowflake</span>

<span>Citus</span>
<span>Greenplum</span>
<span>OmniSci (mapD)</span>
<span>Brytlyt</span>
<span>HyPER</span>

<span>Druid</span>
<span>Pinot</span>

<span>kdb+</span>
<span>Shakti</span>
<span>jd</span>

<span>MariaDB CS</span>

<span>Exasol</span>
<span>MemSQL (SingleStore)</span>
<span>Vertica</span>
<span>SAP HANA</span>
<span>Teradata</span>
<span>Sybase IQ</span>
<span>MS SQL with CS index</span>
<span>Oracle Exadata</span>
<span>IBM Netezza, IBM BLU<span>

<span>TiDB</span>
</p>
</section>


<section class="slide">
<h2>ClickHouse is a Good System</h2>
<img style="float: left; height: 80%; margin-top: -3em;" src="pictures/optimal.webp"/>
</section>

<section class="slide">
<h2>ClickHouse Doesn't Lag</h2>
<p>The system was created from practical tasks, for real-world use.</p>
<p>Developed "bottom-up" based on specific scenarios.</p>
<p>Attention to detail and specialization for workload scenarios.</p>
<p style="margin-top: 5em; color: gray; font-size: 14pt;">Talk "Secrets of ClickHouse Performance Optimization"
<br/><a href="https://www.youtube.com/watch?v=ltg8vstuHUU">https://www.youtube.com/watch?v=ltg8vstuHUU</a></p>
</section>

<section class="slide">
<h2>ClickHouse is a Reliable System</h2>
<p>— cross-datacenter master-master replication;</p>
<p>— reliable writing and data storage;</p>
<p>— protection against hardware failures;</p>
<p>— protection against user errors;</p>
<p>— protection against configuration errors;</p>
<p>— traffic and stored data encryption, authentication;</p>
<p>— all available testing tools in CI;</p>
</section>

<section class="slide">
<h2>ClickHouse is a Convenient System</h2>
<p>SQL language adapted for analytics convenience:</p>
<p>— aliases anywhere in the query;
<br/>— arrays, tuples, lambda functions;
<br/>— aggregate function combinators;
<br/>— LIMIT BY, ASOF JOIN, ANY/SEMI JOIN, argMin/argMax;</p>
<p>Domain-specific functions out of the box:</p>
<p>— click-stream: URL and IP address processing functions.
<br/>— performance monitoring: quantiles;
<br/>— geospatial: geoDistance, pointInPolygon, H3, S2;</p>
</section>

<section class="slide">
<h2>ClickHouse is a Flexible System</h2>
<p class="cloud" style="font-size: 12pt;">
<span>Web analytics.</span><span>Mobile app analytics.</span>
<span>Ads analytics.</span><span>Realtime bidding.</span>
<span>E-commerce analytics.</span><span>Retail.</span>
<span>Games analytics.</span><span>Video streaming analytics.</span>
<span>Media &amp; news analytics.</span>
<span>Social recommendations.</span><span>Classifieds. Dating.</span>
<span>Search engine optimization.</span>

<span>Telecom traffic analysis.</span><span>DPI analysis.</span>
<span>CDR records analysis.</span>
<span>Fraud &amp; spam detection.</span><span>DDoS protection.</span>

<span>Application performance monitoring.</span><span>Logs &amp; metrics.</span>
<span>Security events and logs. SIEM.</span><span>Analytics of corporate networks.</span>
<span>Telemetry.</span><span>Industrial monitoring.</span><span>Sensor data.</span><span>IoT.</span><span>Self-driving cars.</span><span>Agriculture.</span>
<span>Smart cities, surveillance.</span><span>Delivery.</span><span>Taxi.</span><span>Food tech.</span><span>HoReCa.</span>

<span>Scientific datasets.</span><span>Genomics.</span><span>Particle physics.</span><span>Astronomy &amp; astrophysics.</span><span>Econometrics.</span>
<span>ML feature analytics and research.</span>

<span>Trading &amp; financial data.</span><span>Fintech.</span><span>Insurance.</span>
<span>Investment banking.</span><span>Blockchain.</span>
<span>Gambling.</span><span>Adult.</span>

<span>Business intelligence.</span>
</p>
</section>

<section class="slide">
<h2>ClickHouse is an Accessible System</h2>
<p>ClickHouse can be deployed:</p>
<p>— on your own servers;
<br/>— in clouds; with Kubernetes;
<br/>— on customer infrastructure;
<br/>— on a personal laptop.</p>
<p>ClickHouse is available for different platforms:</p>
<p>— x86_64, aarch64 (ARM), <span style="color: gray;">PowerPC 64, RISC-V</span>;
<br/>— Linux, FreeBSD, mac OS.</p>
</section>

<section class="slide">
<h2 style="font-size: 36pt;">ClickHouse is True Open-Source</h2>
<p>Source code is publicly available.</p>
<p>Patches from the community are accepted.</p>
<p>Open development processes.</p>
<p>Low barrier to entry for contributors.</p>
<p>Maximum encouragement and community engagement.</p>

<p style="margin-top: 5em; color: gray; font-size: 14pt;">Talk "How to Build a Thriving Community Around an Open-Source Product"
<br/><a href="https://www.youtube.com/watch?v=xddKLojmkus&amp;t=4165s">https://www.youtube.com/watch?v=xddKLojmkus&amp;t=4165s</a></p>
</section>


<section class="slide">
<h2>ClickHouse is a Bad<span style="color: gray;">*</span> System</h2>
<img style="float: right; height: 80%; margin-top: -3em;" src="pictures/not_optimal.webp"/>
<p style="margin-top: 20em; font-size: 14pt; color: gray;">* — not perfect.</p>
</section>


<section class="slide">
<h2>Replication Requires ZooKeeper</h2>
<p style="line-height: 1.5;"><b>ZooKeeper</b> — a component separate from ClickHouse,
<br/>written in Java, requiring careful configuration<br/> and separate servers.</p>
</section>

<section class="slide">
<h2>ZooKeeper is Going Away!</h2>
<p>1. <b>clickhouse-keeper</b> &mdash; 100% compatible with ZooKeeper<br/>by protocol and data model.</p>
<p>&mdash; compressed logs and snapshots;
<br/>&mdash; no issues with zxid overflow;
<br/>&mdash; no issues with large packets;
<br/>&mdash; better memory usage;
<br/>&mdash; no issues with GC and Java heap;</p>
<p>2. Can be run <b>embedded</b> in clickhouse-server.</p>
<p>&mdash; no need for a separate service;</p>
<p style="color: gray">Developer: Alexander Sapin.</p>
</section>

<section class="slide">
<h2 style="font-size: 32pt;">Data Must Be Inserted in Batches</h2>
<p>You can insert <span style="color: green;">millions of rows per second</span> per server.</p>
<p>But those rows must be in just <span style="color: red;">a few batches per second</span>.</p>
<p style="margin-top: 2em;">You can use <b>Kafka</b> or <b>RabbitMQ</b> tables.</p>
</section>

<section class="slide">
<h2>Asynchronous INSERT Queries</h2>
<p>Ability to make many frequent INSERTs.</p>
<p>From multiple parallel connections.</p>
<p style="color: green;"><b>Without Kafka and without Buffer tables!</b></p>
<p>Multiple small INSERTs are combined together<br/>
into one batch in memory.</p>
<p>Inserts are reliable by default:<br/>client receives a response when data is written to the table.</p>
<p style="color: gray;">Already in production! Developers: Anton Popov, Ivan Lezhankin.</p>
</section>

<section class="slide">
<h2>No Transaction Support</h2>
<p>Why do we need transactions in ClickHouse?</p>
<p>— for atomic insertion into multiple tables and views.</p>
<p>— for atomic cluster insertion.</p>
<p>— for executing multiple SELECTs from one snapshot.</p>
<p style="color: gray; margin-top: 2em;">In development, planned for Q2 2022.</p>
</section>

<section class="slide">
<h2>Insufficient SQL Compatibility</h2>
<p>SQL language in ClickHouse was initially made non-standard for convenience.</p>
<p>Due to a complex name and type resolution mechanism,<br/>queries are difficult to analyze.</p>
<p style="margin-top: 2em; color: green;">There is a way to support all standard capabilities<br/> and keep all ClickHouse extensions!</p>
<p style="margin-top: 2em;">2021: Window Functions, ANY/ALL, EXISTS, GROUPING SETS...</p>
<p>2022: Correlated Subqueries</p>
</section>

<section class="slide">
<h2>Lack of JOIN Optimizations</h2>
<p>Table sorting is not considered for JOIN.</p>
<p>No cost-based optimizer for JOIN reordering.</p>
<p>No grace hash algorithm for JOIN.</p>
<p>No shuffle for distributed JOINs.</p>
<p>And in general, distributed JOINs work poorly.</p>
</section>

<section class="slide">
<h2>No UPSERT</h2>
<p>No point UPDATE and DELETE,<br/>
as well as UNIQUE KEY CONSTRAINT.</p>
<p>Implementing unique key in a distributed system
<br/>&mdash; is a non-trivial task.</p>
</section>

<section class="slide">
<h2>Scaling Complexity</h2>
<p style="color: green;">ClickHouse scales perfectly<br/>to thousands of servers and 100 PB of data.</p>
<p>But changing the number of servers in a cluster is <span style="color: red;">painful</span>.</p>
<p>You need to worry about shard and replica configuration.</p>
<p>Data resharding <span style="color: red;">is done manually</span>.</p>

<p style="margin-top: 2em;">Solution &mdash; cloud-native ClickHouse.</p>
<p style="color: gray;">By the way, what does that mean?</p>
</section>

<section class="slide">
<h2>Resource Separation Complexity</h2>
<p>Separation of CPU and IO between queries.</p>
<p>Query priorities.</p>
<p>Memory overcommit.</p>
</section>

<section class="slide">
<h2 style="font-size: 30pt;">Insufficient Integration Capabilities</h2>
<p>No native UI for ClickHouse</p>
<p>Not enough official integrations with BI and ETL.</p>
<h2 style="font-size: 30pt; margin-top: 2em;">Insufficient Awareness in USA and Europe</h2>
<p>Insufficiently developed documentation.</p>
<p>Lack of educational materials, courses, and support.</p>
</section>

<section class="slide">
<h2>And What to Do About It?</h2>
</section>

<section class="slide">
<h2>ClickHouse, Inc</h2>
<p>Created together with Yandex.</p>
<p>Already raised $300M at a $2B valuation.</p>
</section>

<section class="slide">
<h2>ClickHouse Inc Work Directions</h2>
<ol>
<li style="line-height: 1.5;">Create a cloud service for ClickHouse<br/>
in serverless format with dynamic scaling.</li>
<li style="line-height: 1.5; margin-top: 1.5em;">Development and support of ClickHouse in open-source<br/>
to increase ClickHouse market size.</li>
<li style="line-height: 1.5; margin-top: 1.5em;">Research and experiments<br/>
to find new niches and opportunities for ClickHouse.</li>
</ol>
</section>

<section class="slide">
<h2>New Horizons for ClickHouse</h2>
<p style="line-height: 1.5;">Support for semistructured data.<br/>
Natural language text processing functions.<br/>
Streaming queries and complex event processing.<br/>
Key-value data marts, incremental aggregation in memory.<br/>
Query execution using GPU.<br/>
Integration with ML &amp; AI.<br/>
Graph processing.<br/>
Batch jobs.<br/>
Data Hub.</p>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<p><b>JSON</b> data type:</p>
<code>CREATE TABLE games (data JSON) ENGINE = MergeTree;</code>
<p style="margin-top: 1em;">You can insert arbitrary nested JSONs.</p>
<p>Types are automatically inferred on INSERT and merge.</p>
<p>Data is stored in columnar format: columns and subcolumns.</p>
<p>Query nested data naturally.</p>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<p style="margin-top: -1em;">Example: NBA games dataset</p>

<code>CREATE TABLE games (data String)
ENGINE = MergeTree ORDER BY tuple();

SELECT <span style="color: red;">JSONExtractString(data, 'teams', 1, 'name')</span>
FROM games;</code>
<p style="margin-top: 0.5em; color: red;">&mdash; 0.520 sec.</p>

<code>CREATE TABLE games (data JSON)
ENGINE = MergeTree;

SELECT <span style="color: green;">data.teams.name[1]</span> FROM games;</code>
<p style="margin-top: 0.5em; color: green;">&mdash; 0.015 sec.</p>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<code style="font-size: 12pt; margin-top: -2em;">DESCRIBE TABLE games
SETTINGS describe_extend_object_types = 1

name: data
type: Tuple(                                           &lt;-- inferred type
    `_id.$oid` String,
    `date.$date` String,
    `teams.abbreviation` Array(String),
    `teams.city` Array(String),
    `teams.home` Array(UInt8),
    `teams.name` Array(String),
    `teams.players.ast` Array(Array(Int8)),
    `teams.players.blk` Array(Array(Int8)),
    `teams.players.drb` Array(Array(Int8)),
    `teams.players.fg` Array(Array(Int8)),
    `teams.players.fg3` Array(Array(Int8)),
    `teams.players.fg3_pct` Array(Array(String)),
    `teams.players.fg3a` Array(Array(Int8)),
    `teams.players.fg_pct` Array(Array(String)),
    `teams.players.fga` Array(Array(Int8)),
    `teams.players.ft` Array(Array(Int8)),
    `teams.players.ft_pct` Array(Array(String)),
    `teams.players.fta` Array(Array(Int8)),
    `teams.players.mp` Array(Array(String)),
    `teams.players.orb` Array(Array(Int8)),
    `teams.players.pf` Array(Array(Int8)),
    `teams.players.player` Array(Array(String)),
    `teams.players.plus_minus` Array(Array(String)),
    `teams.players.pts` Array(Array(Int8)),
    `teams.players.stl` Array(Array(Int8)),
    `teams.players.tov` Array(Array(Int8)),
    `teams.players.trb` Array(Array(Int8)),
    `teams.results.ast` Array(Int8),
    `teams.results.blk` Array(Int8),
    `teams.results.drb` Array(Int8),
    `teams.results.fg` Array(Int8),
    `teams.results.fg3` Array(Int8),
    `teams.results.fg3_pct` Array(String),
    `teams.results.fg3a` Array(Int8),
    `teams.results.fg_pct` Array(String),
    `teams.results.fga` Array(Int16),
    `teams.results.ft` Array(Int8),
    `teams.results.ft_pct` Array(String),
    `teams.results.fta` Array(Int8),
    `teams.results.mp` Array(Int16),
    `teams.results.orb` Array(Int8),
    `teams.results.pf` Array(Int8),
    `teams.results.plus_minus` Array(String),
    `teams.results.pts` Array(Int16),
    `teams.results.stl` Array(Int8),
    `teams.results.tov` Array(Int8),
    `teams.results.trb` Array(Int8),
    `teams.score` Array(Int16),
    `teams.won` Array(Int8))</code>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<p>Flexible schema.</p>
<p>You can have columns with strict and flexible schema in one table.</p>
<p>Queries work <span style="color: green;">as fast as</span> with predefined types!</p>
<p style="color: gray; margin-top: 5em;">Planned for Q1 2022.
<br/>Developer: Anton Popov.</p>
</section>

<section class="slide">
<h2>Conclusions</h2>
<p style="line-height: 1.5;">Together with the new company and the open-source community
<br/>we will make ClickHouse the best analytical DBMS in the world!</p>
</section>

    <div class="progress"></div>
    <script src="shower/shower.min.js"></script>

    <!--Video plugin-->
    <link rel="stylesheet" href="shower/shower-video.css">
    <script src="shower/shower-video.js"></script>
    <!--/Video plugin-->
</body>
</html>
