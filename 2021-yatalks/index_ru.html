<!DOCTYPE html>
<html lang="en">
<head>
    <title>ClickHouse: настоящее и будущее</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://presentations.clickhouse.com/shower/themes/clickhouse/styles/styles.css">

    <style>
         code { display: block; white-space: pre; background-color: #EEE; }
         p.cloud { text-align: center; line-height: 2; }
         p.cloud span { color: gray; padding: 0 20px 0 20px; white-space: nowrap; }
    </style>
</head>
<body class="shower list">
    <header class="caption">
        <h1>ClickHouse: настоящее и будущее</h1>
        <p>Author: Alexey Milovidov, 2021-12-06.</p>
    </header>
    <section class="slide" id="cover">
        <h1 style="margin-top: 80px; line-height: 150%; color: black; font-size: 48pt">ClickHouse:<br/>настоящее и будущее</h1>
    </section>

<section class="slide">
<h2>Я расскажу:</h2>
<p>— почему ClickHouse — хорошая система;</p>
<p>— почему ClickHouse — плохая система;</p>
<p>— и что с этим делать.</p>
</section>


<section class="slide">
<p class="cloud" style="margin-top: 2em;">
<span>Impala</span>
<span>Spark SQL</span>
<span>Presto/Trino</span>
<span>Drill</span>
<span>Hawq</span>
<span>Actian Vortex</span>
<span>Kylin</span>
<span>Kudu</span>

<span>MonetDB</span>
<span>Vectorwise</span>
<span>Actian Vector</span>
<span>Actian Matrix</span>
<span>Redshift</span>
<span>Snowflake</span>

<span>Citus</span>
<span>Greenplum</span>
<span>OmniSci (mapD)</span>
<span>Brytlyt</span>
<span>HyPER</span>

<span>Druid</span>
<span>Pinot</span>

<span>kdb+</span>
<span>Shakti</span>
<span>jd</span>

<span>MariaDB CS</span>

<span>Exasol</span>
<span>MemSQL (SingleStore)</span>
<span>Vertica</span>
<span>SAP HANA</span>
<span>Teradata</span>
<span>Sybase IQ</span>
<span>MS SQL with CS index</span>
<span>Oracle Exadata</span>
<span>IBM Netezza, IBM BLU<span>

<span>TiDB</span>
</p>
</section>


<section class="slide">
<h2>ClickHouse — хорошая система</h2>
<img style="float: left; height: 80%; margin-top: -3em;" src="pictures/optimal.webp"/>
</section>

<section class="slide">
<h2>ClickHouse не тормозит</h2>
<p>Система создана из практических задач, для работы в бою.</p>
<p>Разработана &laquo;снизу-вверх&raquo; исходя из конкретных сценариев.</p>
<p>Внимание к деталям и специализация под сценарии нагрузки.</p>
<p style="margin-top: 5em; color: gray; font-size: 14pt;">Доклад &laquo;секреты оптимизации производительности ClickHouse&raquo;
<br/><a href="https://www.youtube.com/watch?v=ltg8vstuHUU">https://www.youtube.com/watch?v=ltg8vstuHUU</a></p>
</section>

<section class="slide">
<h2>ClickHouse — надёжная система</h2>
<p>— кросс-ДЦ master-master репликация;</p>
<p>— надёжная запись и хранение данных;</p>
<p>— защита от сбоев железа;</p>
<p>— защита от ошибок пользователя;</p>
<p>— защита от ошибок конфигурации;</p>
<p>— шифрование трафика и хранимых данных, аутентификация;</p>
<p>— все доступные средства тестирования в CI;</p>
</section>

<section class="slide">
<h2>ClickHouse — удобная система</h2>
<p>Язык SQL, адаптированный для удобства аналитики:</p>
<p>— алиасы в любом месте запроса;
<br/>— массивы, кортежи, лямбда функции;
<br/>— комбинаторы агрегатных функций;
<br/>— LIMIT BY, ASOF JOIN, ANY/SEMI JOIN, argMin/argMax;</p>
<p>Функции для предметной области из коробки:</p>
<p>— click-stream: функции обработки URL и IP-адресов.
<br/>— performance monitoring: квантили;
<br/>— geospatial: geoDistance, pointInPolygon, H3, S2;</p>
</section>

<section class="slide">
<h2>ClickHouse — гибкая система</h2>
<p class="cloud" style="font-size: 12pt;">
<span>Web analytics.</span><span>Mobile app analytics.</span>
<span>Ads analytics.</span><span>Realtime bidding.</span>
<span>E-commerce analytics.</span><span>Retail.</span>
<span>Games analytics.</span><span>Video streaming analytics.</span>
<span>Media &amp; news analytics.</span>
<span>Social recommendations.</span><span>Classifieds. Dating.</span>
<span>Search engine optimization.</span>

<span>Telecom traffic analysis.</span><span>DPI analysis.</span>
<span>CDR records analysis.</span>
<span>Fraud &amp; spam detection.</span><span>DDoS protection.</span>

<span>Application performance monitoring.</span><span>Logs &amp; metrics.</span>
<span>Security events and logs. SIEM.</span><span>Analytics of corporate networks.</span>
<span>Telemetry.</span><span>Industrial monitoring.</span><span>Sensor data.</span><span>IoT.</span><span>Self-driving cars.</span><span>Agriculture.</span>
<span>Smart cities, surveillance.</span><span>Delivery.</span><span>Taxi.</span><span>Food tech.</span><span>HoReCa.</span>

<span>Scientific datasets.</span><span>Genomics.</span><span>Particle physics.</span><span>Astronomy &amp; astrophysics.</span><span>Econometrics.</span>
<span>ML feature analytics and research.</span>

<span>Trading &amp; financial data.</span><span>Fintech.</span><span>Insurance.</span>
<span>Investment banking.</span><span>Blockchain.</span>
<span>Gambling.</span><span>Adult.</span>

<span>Business intelligence.</span>
</p>
</section>

<section class="slide">
<h2>ClickHouse — доступная система</h2>
<p>ClickHouse можно развернуть:</p>
<p>— на своих серверах;
<br/>— в облаках; с Kubernetes;
<br/>— на инфраструктуре заказчика;
<br/>— на личном ноутбуке.</p>
<p>ClickHouse доступен под разные платформы:</p>
<p>— x86_64, aarch64 (ARM), <span style="color: gray;">PowerPC 64, RISC-V</span>;
<br/>— Linux, FreeBSD, mac OS.</p>
</section>

<section class="slide">
<h2 style="font-size: 36pt;">ClickHouse — настоящий open-source</h2>
<p>Исходники доступны публично.</p>
<p>Патчи от сообщества принимаются.</p>
<p>Открытые процессы разработки.</p>
<p>Низкий порог входа для контрибьюторов.</p>
<p>Максимальное поощрение и вовлечение сообщества.</p>

<p style="margin-top: 5em; color: gray; font-size: 14pt;">Доклад &laquo;как организовать живое сообщество вокруг open-source продукта&raquo;
<br/><a href="https://www.youtube.com/watch?v=xddKLojmkus&amp;t=4165s">https://www.youtube.com/watch?v=xddKLojmkus&amp;t=4165s</a></p>
</section>


<section class="slide">
<h2>ClickHouse — плохая<span style="color: gray;">*</span> система</h2>
<img style="float: right; height: 80%; margin-top: -3em;" src="pictures/not_optimal.webp"/>
<p style="margin-top: 20em; font-size: 14pt; color: gray;">* — не идеальная.</p>
</section>


<section class="slide">
<h2>Репликация требует ZooKeeper</h2>
<p style="line-height: 1.5;"><b>ZooKeeper</b> — отдельный от ClickHouse компонент,
<br/>написанный на Java, требующий тщательной настройки<br/> и отдельных серверов.</p>
</section>

<section class="slide">
<h2>ZooKeeper уходит!</h2>
<p>1. <b>clickhouse-keeper</b> &mdash; 100% совместимый с ZooKeeper<br/>по протоколу и модели данных.</p>
<p>&mdash; compressed logs and snapshots;
<br/>&mdash; no issues with zxid overflow;
<br/>&mdash; no issues with large packets;
<br/>&mdash; better memory usage;
<br/>&mdash; no issues with GC and Java heap;</p>
<p>2. Может запускаться <b>встроенным</b> в clickhouse-server.</p>
<p>&mdash; нет необходимости в отдельном сервисе;</p>
<p style="color: gray">Разработчик: Alexander Sapin.</p>
</section>

<section class="slide">
<h2 style="font-size: 32pt;">Данные необходимо вставлять пачками</h2>
<p>Можно вставлять <span style="color: green;">миллионы строк в секунду</span> на каждый сервер.</p>
<p>Но эти строки должны быть всего лишь в <span style="color: red;">нескольких пачках в секунду</span>.</p>
<p style="margin-top: 2em;">Можно использовать <b>Kafka</b> или <b>RabbitMQ</b> таблицы.</p>
</section>

<section class="slide">
<h2>Асинхронные INSERT запросы</h2>
<p>Возможность делать много частых INSERT.</p>
<p>Из множества параллельных соединений.</p>
<p style="color: green;"><b>Без Kafka и без Buffer таблиц!</b></p>
<p>Множество мелких INSERTs комбинируются вместе<br/>
в одну пачку в оперативной памяти.</p>
<p>Вставки надёжные по-умолчанию:<br/>клиент получает ответ, когда данные записаны в таблицу.</p>
<p style="color: gray;">Уже в продакшене! Разработчики: Anton Popov, Ivan Lezhankin.</p>
</section>

<section class="slide">
<h2>Отсутствие поддержки транзакций</h2>
<p>Зачем в ClickHouse транзакции?</p>
<p>&mdash; для атомарной вставки в несколько таблиц и представлений.</p>
<p>&mdash; для атомарной вставки на кластер.</p>
<p>&mdash; для выполнения множества SELECT из одного снапшота.</p>
<p style="color: gray; margin-top: 2em;">В разработке, запланировано на Q2 2022.</p>
</section>

<section class="slide">
<h2>Недостаточная совместимость SQL</h2>
<p>Язык SQL в ClickHouse изначально сделан нестандартным для удобства.</p>
<p>Из-за сложного механизма разрешения имён и типов,<br/>запросы сложно анализировать.</p>
<p style="margin-top: 2em; color: green;">Есть способ поддержать все возможности стандарта<br/> и сохранить все расширения ClickHouse!</p>
<p style="margin-top: 2em;">2021: Window Functions, ANY/ALL, EXISTS, GROUPING SETS...</p>
<p>2022: Correlated Subqueries</p>
</section>

<section class="slide">
<h2>Отсутствие оптимизаций JOIN</h2>
<p>Не учитывается сортировка таблицы для JOIN.</p>
<p>Нет cost based optimizer для переупорядочивания JOIN.</p>
<p>Нет grace hash алгоритма для JOIN.</p>
<p>Нет shuffle для распределённых JOIN.</p>
<p>И вообще распределённые JOIN плохо работают.</p>
</section>

<section class="slide">
<h2>Отсутствие UPSERT</h2>
<p>Отсутствие точечных UPDATE и DELETE,<br/>
а также UNIQUE KEY CONSTRAINT.</p>
<p>Реализовать unique key в распределённой системе
<br/>&mdash; нетривиальная задача.</p>
</section>

<section class="slide">
<h2>Сложность масштабирования</h2>
<p style="color: green;">ClickHouse прекрасно масштабируется<br/>до тысяч серверов и 100 ПБ данных.</p>
<p>Но изменение числа серверов в кластере &mdash; <span style="color: red;">боль</span>.</p>
<p>Нужно заботиться о конфигурации шардов и реплик.</p>
<p>Перешардирование данных <span style="color: red;">осуществляется вручную</span>.</p>

<p style="margin-top: 2em;">Решение &mdash; cloud-native ClickHouse.</p>
<p style="color: gray;">Кстати, а что это значит?</p>
</section>

<section class="slide">
<h2>Сложность разделения ресурсов</h2>
<p>Разделение CPU и IO между запросами.</p>
<p>Приоритеты запросов.</p>
<p>Memory overcommit.</p>
</section>

<section class="slide">
<h2 style="font-size: 30pt;">Недостаточные возможности по интеграции</h2>
<p>Нет родного UI для ClickHouse</p>
<p>Не хватает официальных интеграций с BI и ETL.</p>
<h2 style="font-size: 30pt; margin-top: 2em;">Недостаточная известность в США и Европе</h2>
<p>Недостаточно развитая документация.</p>
<p>Отсутствие обучающих материалов, курсов и поддержки.</p>
</section>

<section class="slide">
<h2>И что с этим делать?</h2>
</section>

<section class="slide">
<h2>Компания ClickHouse, Inc</h2>
<p>Создана вместе с Яндексом.</p>
<p>Уже привлекли 300 млн $ при оценке 2 млрд.</p>
</section>

<section class="slide">
<h2>Направления работы ClickHouse Inc</h2>
<ol>
<li style="line-height: 1.5;">Создать облачный сервис для ClickHouse<br/>
в serverless формате с динамическим масштабированием.</li>
<li style="line-height: 1.5; margin-top: 1.5em;">Развитие и поддержка ClickHouse в open-source<br/>
с целью увеличения размера рынка ClickHouse.</li>
<li style="line-height: 1.5; margin-top: 1.5em;">Исследования и эксперименты<br/>
для поиска новых ниш и возможностей ClickHouse.</li>
</ol>
</section>

<section class="slide">
<h2>Новые горизонты для ClickHouse</h2>
<p style="line-height: 1.5;">Поддержка полуструктурированных данных.<br/>
Функции обработки текста на естественном языке.<br/>
Потоковые запросы и complex event processing.<br/>
Key-value витрины данных, инкрементальная агрегация в оперативке.<br/>
Выполнение запросов с использованием GPU.<br/>
Интеграция с ML &amp; AI.<br/>
Обработка графов.<br/>
Batch jobs.<br/>
Data Hub.</p>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<p><b>JSON</b> data type:</p>
<code>CREATE TABLE games (data JSON) ENGINE = MergeTree;</code>
<p style="margin-top: 1em;">You can insert arbitrary nested JSONs.</p>
<p>Types are automatically inferred on INSERT and merge.</p>
<p>Data is stored in columnar format: columns and subcolumns.</p>
<p>Query nested data naturally.</p>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<p style="margin-top: -1em;">Example: NBA games dataset</p>

<code>CREATE TABLE games (data String)
ENGINE = MergeTree ORDER BY tuple();

SELECT <span style="color: red;">JSONExtractString(data, 'teams', 1, 'name')</span>
FROM games;</code>
<p style="margin-top: 0.5em; color: red;">&mdash; 0.520 sec.</p>

<code>CREATE TABLE games (data JSON)
ENGINE = MergeTree;

SELECT <span style="color: green;">data.teams.name[1]</span> FROM games;</code>
<p style="margin-top: 0.5em; color: green;">&mdash; 0.015 sec.</p>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<code style="font-size: 12pt; margin-top: -2em;">DESCRIBE TABLE games
SETTINGS describe_extend_object_types = 1

name: data
type: Tuple(                                           &lt;-- inferred type
    `_id.$oid` String,
    `date.$date` String,
    `teams.abbreviation` Array(String),
    `teams.city` Array(String),
    `teams.home` Array(UInt8),
    `teams.name` Array(String),
    `teams.players.ast` Array(Array(Int8)),
    `teams.players.blk` Array(Array(Int8)),
    `teams.players.drb` Array(Array(Int8)),
    `teams.players.fg` Array(Array(Int8)),
    `teams.players.fg3` Array(Array(Int8)),
    `teams.players.fg3_pct` Array(Array(String)),
    `teams.players.fg3a` Array(Array(Int8)),
    `teams.players.fg_pct` Array(Array(String)),
    `teams.players.fga` Array(Array(Int8)),
    `teams.players.ft` Array(Array(Int8)),
    `teams.players.ft_pct` Array(Array(String)),
    `teams.players.fta` Array(Array(Int8)),
    `teams.players.mp` Array(Array(String)),
    `teams.players.orb` Array(Array(Int8)),
    `teams.players.pf` Array(Array(Int8)),
    `teams.players.player` Array(Array(String)),
    `teams.players.plus_minus` Array(Array(String)),
    `teams.players.pts` Array(Array(Int8)),
    `teams.players.stl` Array(Array(Int8)),
    `teams.players.tov` Array(Array(Int8)),
    `teams.players.trb` Array(Array(Int8)),
    `teams.results.ast` Array(Int8),
    `teams.results.blk` Array(Int8),
    `teams.results.drb` Array(Int8),
    `teams.results.fg` Array(Int8),
    `teams.results.fg3` Array(Int8),
    `teams.results.fg3_pct` Array(String),
    `teams.results.fg3a` Array(Int8),
    `teams.results.fg_pct` Array(String),
    `teams.results.fga` Array(Int16),
    `teams.results.ft` Array(Int8),
    `teams.results.ft_pct` Array(String),
    `teams.results.fta` Array(Int8),
    `teams.results.mp` Array(Int16),
    `teams.results.orb` Array(Int8),
    `teams.results.pf` Array(Int8),
    `teams.results.plus_minus` Array(String),
    `teams.results.pts` Array(Int16),
    `teams.results.stl` Array(Int8),
    `teams.results.tov` Array(Int8),
    `teams.results.trb` Array(Int8),
    `teams.score` Array(Int16),
    `teams.won` Array(Int8))</code>
</section>

<section class="slide">
<h2>Support For Semistructured Data</h2>
<p>Flexible schema.</p>
<p>You can have columns with strict and flexible schema in one table.</p>
<p>Queries work <span style="color: green;">as fast as</span> with predefined types!</p>
<p style="color: gray; margin-top: 5em;">Planned for Q1 2022.
<br/>Developer: Anton Popov.</p>
</section>

<section class="slide">
<h2>Выводы</h2>
<p style="line-height: 1.5;">Вместе с новой компанией и open-source сообществом
<br/>мы сделаем ClickHouse лучшей аналитической СУБД в мире!</p>
</section>

    <div class="progress"></div>
    <script src="https://presentations.clickhouse.com/shower/shower.js"></script>

    <!--Video plugin-->
    <link rel="stylesheet" href="https://presentations.clickhouse.com/shower/shower-video.css">
    <script src="https://presentations.clickhouse.com/shower/shower-video.js"></script>
    <!--/Video plugin-->
<footer class="badge">
    <a href="https://presentations.clickhouse.com/">ClickHouse Theater</a>
</footer>
</body>
</html>

