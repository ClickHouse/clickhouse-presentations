<!DOCTYPE html>
<html lang="en">
<head>
    <title>Building a Toy With ClickHouse</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:image" content="pictures/preview.jpg">
    <meta property="og:title" content="Building a Toy With ClickHouse">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="pictures/preview.jpg">
    <link rel="stylesheet" href="https://presentations.clickhouse.com/shower/themes/clickhouse/styles/styles.css">

    <style>
        code { display: block; white-space: pre; background-color: #EEE; }
        p.cloud { text-align: center; line-height: 1.6; font-size: 20pt; }
        p.cloud span { color: gray; padding: 0 20px 0 20px; white-space: nowrap; }
         table, tr, td { border: 0; }
        .hilite { background: rgba(255, 255, 255, 80%); padding: 5px; }
    </style>
</head>
<body class="shower list">
    <header class="caption">
        <h1>Building a Toy With ClickHouse</h1>
        <p>Author: Alexey Milovidov, 2023-10-31.</p>
    </header>
    <section class="slide" id="cover" style="background: url(pictures/title.jpg); background-size: cover; background-position: center;">
        <h1 style="margin-top: 20px; line-height: 150%; color: white; font-size: 42pt; text-shadow: -2px 0 black, 0 2px black, 2px 0 black, 0 -2px black;">Building a Toy With ClickHouse</h1>
    </section>

<!--

Building a toy with ClickHouse

Where to get the data?

Reverse DNS. What is it.
Prepared datasets.

How to scan all IPv4? MassDNS?
Digital Ocean. AWS.

DoH
Google, Cloudflare
Greynoise.
Internet Telescopes.

Inserting into a staging table.
Materialized views
JSON processing.

Basic data analysis.
Finding ClickHouse servers.
Shodan.

Data visualization. Internet map pictures.
xkcd

IANA, ARIN, RIPE, APNIC, AFRINIC

space filling curves
png from ClickHouse

URL functions. Hashing.

4 gigapixel.

Tiles
Leaflet, Openseadragon

JavaScript code

Demo

Quotas

-->

<section class="slide">
<h2>Let's build a demo app on ClickHouse</h2>
<p>What for?</p>
<p>&mdash; Testing. </p>
<p>&mdash; An internal company contest.</p>
<p>&mdash; I always like to play with ClickHouse and have fun :)</p>
</section>

<section class="slide">
<h2>How?</h2>
<p>We will need:</p>
<p>&mdash; an idea.</p>
<p>&mdash; a nice <b>dataset</b>.</p>
<p>&mdash; a way to analyze and visialize it.</p>
</section>

<section class="slide">
<h2>A Dataset</h2>
<p>We want an "internet-scale" dataset. How to get it? ğŸ¤”</p>
<p>&mdash; get it from the Internet ğŸ¤«</p>
</section>

<section class="slide">
<h2>DNS</h2>
<p>Forward:
<code style="font-size: 16pt; line-height: 1.5; margin-top: 1em;">$ host <b>google.com</b>
google.com has address <b>142.250.179.174</b>
google.com has IPv6 address 2a00:1450:400e:802::200e
google.com mail is handled by 10 smtp.google.com.</code></p>

<p>Reverse:
<code style="font-size: 16pt; line-height: 1.5; margin-top: 1em;">$ host <b>142.250.179.174</b>
174.179.250.142.in-addr.arpa domain name pointer
ams15s41-in-f14.<b style="color: green;">1e100.net</b>.</code></p>
</section>

<section class="slide">
<h2>DNS</h2>
<p>Forward:
<code style="font-size: 16pt; line-height: 1.5; margin-top: 1em;">$ dig @1.1.1.1 google.com -t A
;; ANSWER SECTION:
google.com.             159     IN      A       <b>142.250.179.174</b>
</code></p>

<p>Reverse:
<code style="font-size: 16pt; line-height: 1.5; margin-top: 1em;">$ dig @1.1.1.1 <b>174.179.250.142</b>.in-addr.arpa -t PTR
;; ANSWER SECTION:
<b>174.179.250.142</b>.in-addr.arpa. 81998 IN  PTR
     ams15s41-in-f14.<b style="color: green;">1e100.net</b>.net.
</code></p>
</section>

<section class="slide">
<h2>Why do PTR records exist?</h2>
<p><code style="font-size: 12pt; line-height: 1.5; margin-top: 1em;">$ mtr google.com

 1. <b>2a02-a210-1111-a500-aef8-ccff-fedc-1234.cable.dynamic.v6.ziggo.nl</b>
 2. (waiting for reply)
 3. 2a02:a200:0:12::1
 4. <b>asd-tr0021-cr101-lo10.core.as9143.net</b>
 5. <b>nl-ams14a-ri1-ae51-0.core.as9143.net</b>
 6. 2001:4860:1:1::2ac
 7. 2a00:1450:8012::1
 8. 2001:4860:0:1::e36
 9. 2001:4860:0:f8b::c
10. 2001:4860::c:4002:c2d0
11. 2001:4860::1:0:cd13
12. 2001:4860:0:f8c::1
13. 2001:4860:0:1::5a85
14. <b>ams17s12-in-x0e.1e100.net</b></code></p>
</section>

<section class="slide">
<h2>Scan All IPv4</h2>
<p>... to perform reverse DNS request on all of them.</p>
<p>There are only 2<sup>32</sup> IP addresses.</p>
<p>Slightly less than 4 billion belongs to Internet.</p>
<p style="margin-top: 2em;">How to do the scan?</p>
</section>

<section class="slide">
<h2>Scan All IPv4</h2>
<p>... to perform reverse DNS request on all of them.</p>
<p>There are tools for that:</p>
<p>&mdash; MassDNS: <a href="https://github.com/blechschmidt/massdns">https://github.com/blechschmidt/massdns</a></p>
<p>&mdash; GNU adns library: <a href="https://github.com/lucab/adns">https://www.gnu.org/software/adns/</a></p>
<p>Advantages: <span style="color: green;">they are fast :)</span></p>
<p>Disadvantages: <span style="color: red;">you will be blocked :(</span></p>
</section>

<section class="slide">
<h2>Scan All IPv4</h2>
<p>Where to do it?</p>
<p><b>From home?</b><br/>
&mdash; your ISP will be surprised by unusual traffic.</p>
<p><b>From a datacenter?</b><br/>
&mdash; my friend tried it from Digital Ocean and was blocked.</p>
<p><b>In the cloud?</b><br/>
&mdash; if you do it in AWS, it is ok if you communicate in advance.</p>
<p>What option did I choose?</p>
</section>

<section class="slide">
<h2>DNS Over HTTPS (DoH)</h2>
<p style="margin-top: -1em;">DNS can work:</p>
<p>
&mdash; over UDP (unreliable and not secure);<br/>
&mdash; over TCP (reliable but not secure);<br/>
&mdash; over TLS (reliable and secure, but heavyweight);<br/>
&mdash; over HTTPS (reliable and secure, but heavyweight);<br/>
&mdash; DNSCrypt over TCP or UDP (very different);</p>

<p><code style="font-size: 14pt; line-height: 1.5; margin-left: -2em; margin-right: -3em;">curl -H 'accept: application/dns-json' \
'https://<b>cloudflare-dns.com</b>/dns-query?name=174.179.250.142.in-addr.arpa&amp;type=PTR'</code></p>

<p><code style="font-size: 14pt; line-height: 1.5; margin-left: -2em; margin-right: -3em;">curl -H 'accept: application/dns-json' \
'https://<b style="color: green;">1.1.1.1</b>/dns-query?name=174.179.250.142.in-addr.arpa&amp;type=PTR'</code></p>
</section>

<section class="slide">
<h2>DNS Over HTTPS (DoH)</h2>

<p><code style="font-size: 14pt; line-height: 1; margin-top: -1em;">$ curl -H 'accept: application/dns-json' \
'https://<b style="color: green;">1.1.1.1</b>/dns-query?name=174.179.250.142.in-addr.arpa&amp;type=PTR' \
| jq

{
  "Status": 0,
  "TC": false, "RD": true, "RA": true, "AD": false, "CD": false,
  "Question": [
    {
      "name": "174.179.250.142.in-addr.arpa",
      "type": 12
    }
  ],
  "Answer": [
    {
      "name": "174.179.250.142.in-addr.arpa",
      "type": 12,
      "TTL": 77114,
      "data": "<b>ams15s41-in-f14.1e100.net.</b>"
    }
  ]
}
</code></p>

</section>

<section class="slide">
<h2>DNS Over HTTPS (DoH)</h2>

<p>Bonus: it can use HTTP 1.0, 1.1, 2, 3.</p>

<p><code style="font-size: 14pt; line-height: 1.5;">curl --http2 -H 'accept: application/dns-json' \
'https://1.1.1.1/dns-query?name=174.179.250.142.in-addr.arpa&amp;type=PTR' \
<b>--next --http2</b> -H 'accept: application/dns-json' \
'https://1.1.1.1/dns-query?name=3.121.82.140.in-addr.arpa&amp;type=PTR'
</code></p>

<p>CloudFlare, Google, OpenDNS have this service.</p>
<p>Using it for a mass scan could violate ToS,
<br/>but at least CloudFlare does not restrict it.</p>
<p>They are processing trillions of requests every day anyway :)</p>
</section>

<section class="slide">
<h2>Table For Results</h2>
<p><code style="font-size: 14pt; line-height: 1.5;">CREATE TABLE dns
(
    time DateTime DEFAULT now(),
    json String
)
ENGINE = MergeTree
ORDER BY ();
</code></p>
<p>We'll write the responses as is, and parse later.</p>
</section>

<section class="slide">
<h2>A Script For DNS Scan</h2>
<p><code style="font-size: 13pt; line-height: 1.5; margin-top: -1em; margin-left: -1em;">clickhouse-local --max_block_size 1 --progress --query "
  WITH number DIV 65536 AS a, number DIV 256 MOD 256 AS b, number MOD 256 AS c
  SELECT c::String || '.' || b::String || '.' || a::String
  FROM numbers(16777216)
  WHERE (a > 0 AND a &lt; 127 AND a != 10)
     OR (a >= 128 AND a &lt; 192 AND (a != 172 OR b &lt; 16 OR b > 31)
         AND (a != 169 AND b != 254))
     OR (a >= 192 AND a &lt; 224 AND (a != 192 OR b != 168))
" | xargs -P1000 -I{} bash -c "
  seq 0 255 | sed -r -e '
s@(.*)@--next --http2 -H \"accept: application/dns-json\" \
\"https://1.1.1.1/dns-query?name=\\1.{}.in-addr.arpa\\&amp;type=PTR\"@' \
| tr '\n' ' ' | sed 's/--next/curl -sS/' | bash \
| clickhouse-client --send_timeout 60000 --receive_timeout 60000 --query '
  INSERT INTO dns (json) FORMAT JSONAsString'"
</code></p>
</section>

<section class="slide" style="background: url(pictures/disaster.webp) no-repeat black; background-size: cover; background-position: center;">
<p style="position: absolute; left: 5px; bottom: 5px; color: white; font-size: 6pt; text-shadow: black 1px 1px 1px;">2005, ZoÃ« Roth family.</p>
</section>

<section class="slide">
<h2>A Script For DNS Scan</h2>
<p>I tried to be <span style="color: green;">gentle</span> and run it from a single machine...</p>
<p>How long did it take?</p>
</section>

<section class="slide">
<h2>A Script For DNS Scan</h2>
<p>I tried to be gentle and run it from a single machine...</p>
<p>How long did it take?</p>
<p><b style="color: green;">&mdash; around ten days.</b></p>
<p><span style="color: gray;">&mdash; it could be just a few hours with MassDNS.</span></p>
</section>

<section class="slide">
<img style="width: 100%;" src="pictures/greynoise.png"/>
</section>

<section class="slide">
<h2>I didn't have to do it</h2>
<p>There are open datasets of historical DNS scans:</p>
<p>Project Sonar: <a href="https://opendata.rapid7.com/sonar.rdns_v2/">https://opendata.rapid7.com/sonar.rdns_v2/</a></p>
</section>

<section class="slide">
<h2>Dataset</h2>

<p><code style="font-size: 14pt; line-height: 1.5;">:) SELECT formatReadableQuantity(count()) FROM dns

â”Œâ”€formatReadableQuantity(count())â”€â”
â”‚ 3.69 billion                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

:) SELECT formatReadableSize(total_bytes)
   FROM system.tables WHERE name = 'dns'

â”Œâ”€formatReadableSize(total_bytes)â”€â”
â”‚ 13.69 GiB                       â”‚ <span style="color: gray;">-- we are storing JSON as a string</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></p>
</section>

<section class="slide">
<h2>Dataset</h2>

<p><code style="font-size: 14pt; line-height: 1.5;">:) SELECT
    name,
    formatReadableSize(data_compressed_bytes) AS compr,
    formatReadableSize(data_uncompressed_bytes) AS raw,
    round(data_uncompressed_bytes / data_compressed_bytes, 2) AS ratio
FROM system.columns
WHERE table = 'dns' AND name = 'json'

â”Œâ”€nameâ”€â”¬â”€comprâ”€â”€â”€â”€â”€â”¬â”€rawâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€ratioâ”€â”
â”‚ json â”‚ <b>13.66 GiB</b> â”‚ <b>896.18 GiB</b> â”‚  <b style="color: green;">65.6</b> â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”˜
</code></p>
</section>

<section class="slide">
<h2>Parse The Dataset</h2>

<p><code style="font-size: 13pt; line-height: 1.5;"><b>CREATE TABLE</b> dns_parsed ENGINE = MergeTree ORDER BY ip
AS
<b>WITH</b> JSONExtract(json,
'Tuple(Status UInt8, TC Bool, RD Bool, RA Bool, AD Bool, CD Bool,
    Question Array(Tuple(name String)),
    Answer Array(Tuple(name String, type UInt8, TTL UInt32, data String)),
    Authority Array(Tuple(name String, type UInt8, TTL UInt32, data String)),
    Comment Array(String))') AS t
<b>SELECT</b> time, t.Status, t.TC, t.RD, t.RA, t.AD, t.CD,
toIPv4(byteSwap(IPv4StringToNum(extract(
  tupleElement(t.Question[1], 'name'), '^(\d+\.\d+\.\d+\.\d+)\.')))) AS ip,
replaceRegexpOne(tupleElement(t.Answer[1], 'data'), '\.$', '') AS domain
FROM dns WHERE t.Answer != ''
SETTINGS allow_experimental_analyzer = 1;
</code></p>
</section>

<section class="slide">
<h2>Parse The Dataset</h2>
<p><code style="font-size: 14pt; line-height: 1.5;">CREATE TABLE dns_parsed
(
    `time` DateTime,
    `t.Status` UInt8,
    `t.TC` Bool,
    `t.RD` Bool,
    `t.RA` Bool,
    `t.AD` Bool,
    `t.CD` Bool,
    `ip` IPv4,
    `domain` String,
)
ENGINE = MergeTree
ORDER BY ip
</code></p>
</section>

<section class="slide">
<h2>Dataset</h2>
<p><code style="font-size: 12pt; line-height: 1; margin-top: -1em;">:) SELECT formatReadableSize(total_bytes) FROM system.tables
   WHERE name = 'dns_parsed'

â”Œâ”€formatReadableSize(total_bytes)â”€â”
â”‚ 4.88 GiB                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

:) SELECT name,
   formatReadableSize(data_compressed_bytes) AS compr,
   formatReadableSize(data_uncompressed_bytes) AS raw,
   round(data_uncompressed_bytes / data_compressed_bytes, 2) AS ratio
FROM system.columns WHERE table = 'dns_parsed'
ORDER BY data_compressed_bytes DESC

â”Œâ”€nameâ”€â”€â”€â”€â”€â”¬â”€comprâ”€â”€â”€â”€â”€â”€â”¬â”€rawâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€ratioâ”€â”
â”‚ ip       â”‚ 3.24 GiB   â”‚ 4.78 GiB  â”‚    1.47 â”‚
â”‚ domain   â”‚ 1.54 GiB   â”‚ 42.09 GiB â”‚   27.41 â”‚
â”‚ time     â”‚ 31.68 MiB  â”‚ 4.78 GiB  â”‚  154.43 â”‚
â”‚ t.RD     â”‚ 859.97 KiB â”‚ 1.19 GiB  â”‚ 1456.31 â”‚
â”‚ t.RA     â”‚ 859.97 KiB â”‚ 1.19 GiB  â”‚ 1456.31 â”‚
â”‚ t.Status â”‚ 549.66 KiB â”‚ 11.28 MiB â”‚   21.02 â”‚
â”‚ t.AD     â”‚ 151.60 KiB â”‚ 6.03 MiB  â”‚    40.7 â”‚
â”‚ t.TC     â”‚ 96.74 KiB  â”‚ 1.50 MiB  â”‚    15.9 â”‚
â”‚ t.CD     â”‚ 96.74 KiB  â”‚ 1.50 MiB  â”‚    15.9 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></p>
</section>

<section class="slide">
<h2>Dataset</h2>
<p><code style="font-size: 14pt; line-height: 1.25;">:) SELECT ip, domain FROM dns_parsed ORDER BY ip LIMIT 10

â”Œâ”€ipâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€domainâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1.0.0.1   â”‚ one.one.one.one            â”‚
â”‚ 1.0.4.4   â”‚ ns1.gtelecom.com.au        â”‚
â”‚ 1.0.4.5   â”‚ auth1.gtelecom.com.au      â”‚
â”‚ 1.0.5.5   â”‚ ns2.gtelecom.com.au        â”‚
â”‚ 1.0.6.6   â”‚ ns3.gtelecom.com.au        â”‚
â”‚ 1.0.16.70 â”‚ smtp.kakeibo.tepco.co.jp   â”‚
â”‚ 1.0.16.71 â”‚ smtp01.kakeibo.tepco.co.jp â”‚
â”‚ 1.0.16.72 â”‚ smtp02.kakeibo.tepco.co.jp â”‚
â”‚ 1.0.16.73 â”‚ smtp03.kakeibo.tepco.co.jp â”‚
â”‚ 1.0.16.74 â”‚ smtp04.kakeibo.tepco.co.jp â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></p>
<p>What are the most popular TLDs? Orgs?</p>
</section>


<section class="slide">
<h2>Dataset</h2>
<p><code style="font-size: 14pt; line-height: 1.25;">:) SELECT topLevelDomain(domain) AS d, count() AS c, bar(c, 0, 1e9, 50)
FROM dns_parsed GROUP BY d ORDER BY c DESC LIMIT 10

â”Œâ”€dâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€câ”€â”¬â”€bar(count(), 0, 1000000000., 50)â”€â”
â”‚ net â”‚ 406985266 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–            â”‚
â”‚ com â”‚ 281925343 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                   â”‚
â”‚ jp  â”‚  77920764 â”‚ â–ˆâ–ˆâ–ˆâ–‰                             â”‚
â”‚ br  â”‚  54343724 â”‚ â–ˆâ–ˆâ–‹                              â”‚
â”‚ de  â”‚  53843959 â”‚ â–ˆâ–ˆâ–‹                              â”‚
â”‚ it  â”‚  34083123 â”‚ â–ˆâ–‹                               â”‚
â”‚ fr  â”‚  24368263 â”‚ â–ˆâ–                               â”‚
â”‚ mx  â”‚  21451597 â”‚ â–ˆ                                â”‚
â”‚ cn  â”‚  18691219 â”‚ â–‰                                â”‚
â”‚ ru  â”‚  17262632 â”‚ â–Š                                â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></p>
</section>


<section class="slide">
<h2>Dataset</h2>
<p><code style="font-size: 14pt; line-height: 1.25;">:) SELECT cutToFirstSignificantSubdomain(domain) AS d, count() AS c,
    bar(c, 0, 1e8, 50)
FROM dns_parsed GROUP BY d ORDER BY c DESC LIMIT 10

â”Œâ”€dâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€câ”€â”¬â”€bar(count(), 0, 100000000., 50)â”€â”
â”‚ amazonaws.com    â”‚ 56667330 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   â”‚
â”‚ comcast.net      â”‚ 40638365 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–           â”‚
â”‚ bbtec.net        â”‚ 39534782 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š            â”‚
â”‚ spectrum.com     â”‚ 31682763 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                â”‚
â”‚ sbcglobal.net    â”‚ 31406669 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                â”‚
â”‚ myvzw.com        â”‚ 30122993 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                 â”‚
â”‚ t-ipconnect.de   â”‚ 25722620 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š                   â”‚
â”‚ rr.com           â”‚ 23476357 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                    â”‚
â”‚ telecomitalia.it â”‚ 19438417 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹                      â”‚
â”‚ verizon.net      â”‚ 16205490 â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></p>
</section>

<section class="slide">
<h2>Dataset</h2>
<p><code style="font-size: 14pt; line-height: 1.25; margin-top: -1em; height: 23em; overflow-y: scroll;">:) SELECT domain AS d, count() AS c
FROM dns_parsed WHERE domain LIKE '%clickhouse%'
GROUP BY d ORDER BY d

â”Œâ”€dâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€câ”€â”
â”‚ appodeal-clickhouse-staging                        â”‚ 1 â”‚
â”‚ bettrade.prod.clickhouse-1                         â”‚ 1 â”‚
â”‚ bettrade.stage.clickhouse-1                        â”‚ 1 â”‚
â”‚ bhs-clickhouse-0.justuno.com                       â”‚ 1 â”‚
â”‚ bhs-clickhouse-1.justuno.com                       â”‚ 1 â”‚
â”‚ bhs-clickhouse-2.justuno.com                       â”‚ 1 â”‚
â”‚ bhs-clickhouse-3.justuno.com                       â”‚ 1 â”‚
â”‚ bhs-clickhouse-4.justuno.com                       â”‚ 1 â”‚
â”‚ bi-clickhouse-playground.dev.scraperapi.com        â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-distribution-nyc1              â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-log-nyc1                       â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r1s1-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r1s2-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r1s3-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r2s1-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r2s2-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r2s3-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r3s1-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r3s2-nyc1                      â”‚ 1 â”‚
â”‚ bitmedia.clickhouse-r3s3-nyc1                      â”‚ 1 â”‚
â”‚ bpce-production-clickhouse01.kameleoon.net         â”‚ 1 â”‚
â”‚ bpce-production-clickhouse02.kameleoon.net         â”‚ 1 â”‚
â”‚ cld-clickhouse-log-new.q.smailru.net               â”‚ 1 â”‚
â”‚ cld-clickhouse-log.q.smailru.net                   â”‚ 1 â”‚
â”‚ cld-clickhouse-proxy.q.smailru.net                 â”‚ 1 â”‚
â”‚ cld-graphite-clickhouse.q.smailru.net              â”‚ 1 â”‚
â”‚ clickhouse-001-08.adpartner.pro                    â”‚ 1 â”‚
â”‚ clickhouse-001-09.adpartner.pro                    â”‚ 1 â”‚
â”‚ clickhouse-002-08.adpartner.pro                    â”‚ 1 â”‚
â”‚ clickhouse-002-09.adpartner.pro                    â”‚ 1 â”‚
â”‚ clickhouse-01-airflow.platform.aviata.team         â”‚ 1 â”‚
â”‚ clickhouse-01.dev.fxcintel.com                     â”‚ 1 â”‚
â”‚ clickhouse-01.ele26126.jscrambler.com              â”‚ 1 â”‚
â”‚ clickhouse-01.hipler.me                            â”‚ 1 â”‚
â”‚ clickhouse-01.lmd91999.jscrambler.com              â”‚ 1 â”‚
â”‚ clickhouse-01.nps00666.jscrambler.com              â”‚ 1 â”‚
â”‚ clickhouse-01.platform.aviata.team                 â”‚ 1 â”‚
â”‚ clickhouse-01.staging.fxcintel.com                 â”‚ 1 â”‚
â”‚ clickhouse-02.dev.fxcintel.com                     â”‚ 1 â”‚
â”‚ clickhouse-02.platform.aviata.team                 â”‚ 1 â”‚
â”‚ clickhouse-03.platform.aviata.team                 â”‚ 1 â”‚
â”‚ clickhouse-1-fi.subh.net                           â”‚ 1 â”‚
â”‚ clickhouse-1-u633.vm.elestio.app                   â”‚ 1 â”‚
â”‚ clickhouse-1.cdn77.com                             â”‚ 1 â”‚
â”‚ clickhouse-1.dorg.cc                               â”‚ 1 â”‚
â”‚ clickhouse-1.man.exa.net.uk                        â”‚ 1 â”‚
â”‚ clickhouse-1.stofa.net                             â”‚ 1 â”‚
â”‚ clickhouse-12.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-13.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-14.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-15.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-16.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-17.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-2-de.subh.net                           â”‚ 1 â”‚
â”‚ clickhouse-2.man.exa.net.uk                        â”‚ 1 â”‚
â”‚ clickhouse-21.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-22.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-23.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-24.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-25.dorg.cc                              â”‚ 1 â”‚
â”‚ clickhouse-3-fi.subh.net                           â”‚ 1 â”‚
â”‚ clickhouse-3.man.exa.net.uk                        â”‚ 1 â”‚
â”‚ clickhouse-4-de.subh.net                           â”‚ 1 â”‚
â”‚ clickhouse-4.dorg.cc                               â”‚ 1 â”‚
â”‚ clickhouse-4.man.exa.net.uk                        â”‚ 1 â”‚
â”‚ clickhouse-5.dorg.cc                               â”‚ 1 â”‚
â”‚ clickhouse-5.man.exa.net.uk                        â”‚ 1 â”‚
â”‚ clickhouse-6.man.exa.net.uk                        â”‚ 1 â”‚
â”‚ clickhouse-7.dorg.cc                               â”‚ 1 â”‚
â”‚ clickhouse-78f2-c27b61                             â”‚ 1 â”‚
â”‚ clickhouse-8.dorg.cc                               â”‚ 1 â”‚
â”‚ clickhouse-9.dorg.cc                               â”‚ 1 â”‚
â”‚ clickhouse-backup0d.dt07.net                       â”‚ 1 â”‚
â”‚ clickhouse-backup1.dt07.net                        â”‚ 1 â”‚
â”‚ clickhouse-ch-dev-1-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-ch-dev-2-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-ch-dev-3-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-ch-dev-4-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-ch-prod-1-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse-ch-prod-2-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse-ch-prod-3-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse-ch-prod-4-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse-control.corp.cloudlinux.com             â”‚ 1 â”‚
â”‚ clickhouse-dev.do.stp.local                        â”‚ 1 â”‚
â”‚ clickhouse-eval.es.net                             â”‚ 1 â”‚
â”‚ clickhouse-fsn-1.tradesoft.ru                      â”‚ 1 â”‚
â”‚ clickhouse-fsn-2.tradesoft.ru                      â”‚ 1 â”‚
â”‚ clickhouse-fsn-3.tradesoft.ru                      â”‚ 1 â”‚
â”‚ clickhouse-graphite-staging.innogames.de           â”‚ 1 â”‚
â”‚ clickhouse-graphite-testing.innogames.de           â”‚ 1 â”‚
â”‚ clickhouse-graphite.innogames.de                   â”‚ 1 â”‚
â”‚ clickhouse-hel-1.tradesoft.ru                      â”‚ 1 â”‚
â”‚ clickhouse-idrac.find.smapps.org                   â”‚ 1 â”‚
â”‚ clickhouse-ixc-1.hoztnode.net                      â”‚ 1 â”‚
â”‚ clickhouse-logs02                                  â”‚ 2 â”‚
â”‚ clickhouse-logs03                                  â”‚ 1 â”‚
â”‚ clickhouse-logs04                                  â”‚ 1 â”‚
â”‚ clickhouse-proactive1.cc-omsk.ertelecom.ru         â”‚ 1 â”‚
â”‚ clickhouse-proactive2.cc-perm.ertelecom.ru         â”‚ 1 â”‚
â”‚ clickhouse-prodev.ele26126.jscrambler.com          â”‚ 1 â”‚
â”‚ clickhouse-scfnx-u4604.vm.elestio.app              â”‚ 1 â”‚
â”‚ clickhouse-stage.mapper                            â”‚ 1 â”‚
â”‚ clickhouse-stats.eudc.cloud                        â”‚ 1 â”‚
â”‚ clickhouse-tds-01.do.stp-cis.local                 â”‚ 1 â”‚
â”‚ clickhouse-tds-01.do.stp-int.local                 â”‚ 1 â”‚
â”‚ clickhouse-tds-01.do.stp.local                     â”‚ 1 â”‚
â”‚ clickhouse-tds-02.do.stp-cis.local                 â”‚ 1 â”‚
â”‚ clickhouse-tds-02.do.stp-int.local                 â”‚ 1 â”‚
â”‚ clickhouse-tds-02.do.stp.local                     â”‚ 1 â”‚
â”‚ clickhouse-tv-analytics-1.stofa.net                â”‚ 1 â”‚
â”‚ clickhouse-u466.vm.elestio.app                     â”‚ 1 â”‚
â”‚ clickhouse-uploader01.42n.dk                       â”‚ 1 â”‚
â”‚ clickhouse-west1-ipmi.es.net                       â”‚ 1 â”‚
â”‚ clickhouse-west1.es.net                            â”‚ 1 â”‚
â”‚ clickhouse-west2-ipmi.es.net                       â”‚ 1 â”‚
â”‚ clickhouse-west2.es.net                            â”‚ 1 â”‚
â”‚ clickhouse-zk-dev-1-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-zk-dev-2-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-zk-dev-3-public.htz.appfollow.io        â”‚ 1 â”‚
â”‚ clickhouse-zk-prod-1-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse-zk-prod-2-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse-zk-prod-3-public.htz.appfollow.io       â”‚ 1 â”‚
â”‚ clickhouse.adgoaltech.net                          â”‚ 1 â”‚
â”‚ clickhouse.com                                     â”‚ 1 â”‚
â”‚ clickhouse.cruise.smapps.org                       â”‚ 1 â”‚
â”‚ clickhouse.cryptoboom.com                          â”‚ 1 â”‚
â”‚ clickhouse.db.eait.uq.edu.au                       â”‚ 1 â”‚
â”‚ clickhouse.dev                                     â”‚ 1 â”‚
â”‚ clickhouse.do.stp.local                            â”‚ 1 â”‚
â”‚ clickhouse.ecomru.ru                               â”‚ 1 â”‚
â”‚ clickhouse.ellada.space                            â”‚ 1 â”‚
â”‚ clickhouse.enaza.ru                                â”‚ 1 â”‚
â”‚ clickhouse.equeo.de                                â”‚ 1 â”‚
â”‚ clickhouse.find.smapps.org                         â”‚ 1 â”‚
â”‚ clickhouse.flashphoner.com                         â”‚ 1 â”‚
â”‚ clickhouse.growadvertising.com                     â”‚ 1 â”‚
â”‚ clickhouse.gsn.do-00                               â”‚ 1 â”‚
â”‚ clickhouse.gsn.do-01                               â”‚ 1 â”‚
â”‚ clickhouse.h.loggie.co                             â”‚ 1 â”‚
â”‚ clickhouse.lbl.gov                                 â”‚ 1 â”‚
â”‚ clickhouse.m.af.de                                 â”‚ 1 â”‚
â”‚ clickhouse.mahjong.smapps.org                      â”‚ 1 â”‚
â”‚ clickhouse.outofcloud.ru                           â”‚ 1 â”‚
â”‚ clickhouse.pulkovo-airport.com                     â”‚ 1 â”‚
â”‚ clickhouse.qencode.com                             â”‚ 1 â”‚
â”‚ clickhouse.realty.p.smailru.net                    â”‚ 1 â”‚
â”‚ clickhouse.smapps.net                              â”‚ 1 â”‚
â”‚ clickhouse.solitaire.smapps.org                    â”‚ 1 â”‚
â”‚ clickhouse.testomat.io                             â”‚ 1 â”‚
â”‚ clickhouse.toadman.io                              â”‚ 1 â”‚
â”‚ clickhouse.youlahdp.p.smailru.net                  â”‚ 1 â”‚
â”‚ clickhouse.zav.org.ua                              â”‚ 1 â”‚
â”‚ clickhouse00.gpn                                   â”‚ 1 â”‚
â”‚ clickhouse001.fra.eu.mktgoo.net                    â”‚ 1 â”‚
â”‚ clickhouse01-dev.node.dc01.int.timo.group          â”‚ 1 â”‚
â”‚ clickhouse01.adapex.io                             â”‚ 1 â”‚
â”‚ clickhouse01.dnx.lu                                â”‚ 1 â”‚
â”‚ clickhouse01.gb.smailru.net                        â”‚ 1 â”‚
â”‚ clickhouse01.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse01.ovh.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse01.stat.ams2.conversify.com              â”‚ 1 â”‚
â”‚ clickhouse02.dnx.lu                                â”‚ 1 â”‚
â”‚ clickhouse02.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse02.ovh.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse02.stat.ams2.conversify.com              â”‚ 1 â”‚
â”‚ clickhouse03.dnx.lu                                â”‚ 1 â”‚
â”‚ clickhouse03.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse03.ovh.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse03.stat.ams2.conversify.com              â”‚ 1 â”‚
â”‚ clickhouse04.dnx.lu                                â”‚ 1 â”‚
â”‚ clickhouse04.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse05.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse06.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse07.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse08.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse09.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse09.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse1-1.ssel2.imcmdb.net                     â”‚ 1 â”‚
â”‚ clickhouse1-1.sselp15.imcmdb.net                   â”‚ 1 â”‚
â”‚ clickhouse1.cluster.zebralution.it                 â”‚ 1 â”‚
â”‚ clickhouse1.nyc1.crafty.ner                        â”‚ 1 â”‚
â”‚ clickhouse10.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse10.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse11.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse11.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse12.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse12.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse13.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse13.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse14.het.mrf.io                            â”‚ 1 â”‚
â”‚ clickhouse14.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse15.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse16.sdkl.info                             â”‚ 1 â”‚
â”‚ clickhouse2.cluster.zebralution.it                 â”‚ 1 â”‚
â”‚ clickhouse2.fppressa.ru                            â”‚ 1 â”‚
â”‚ clickhouse2.nyc1.fontbundles.net                   â”‚ 1 â”‚
â”‚ clickhouse2.r-lab.biz                              â”‚ 1 â”‚
â”‚ clickhousemysqlslave01.dnx.lu                      â”‚ 1 â”‚
â”‚ club.prod.clickhouse.main                          â”‚ 1 â”‚
â”‚ club.stage.clickhouse.main                         â”‚ 1 â”‚
â”‚ conclickhouse001.srv.conova.net                    â”‚ 1 â”‚
â”‚ de-hz-clickhouse1                                  â”‚ 1 â”‚
â”‚ defra1-clickhousecdn01d.sys.i3d.network            â”‚ 1 â”‚
â”‚ defra1-clickhousecdn02d.sys.i3d.network            â”‚ 1 â”‚
â”‚ defra1-clickhousecdn03d.sys.i3d.network            â”‚ 1 â”‚
â”‚ defra1-clickhousecdn04d.sys.i3d.network            â”‚ 1 â”‚
â”‚ dev-clickhouse1.nyc1.crafty.net                    â”‚ 1 â”‚
â”‚ dwh-clickhouse.dc.smailru.net                      â”‚ 1 â”‚
â”‚ fi-hz-clickhouse2                                  â”‚ 1 â”‚
â”‚ fiddler-clickhouse-node-0.sd.spawar.navy.mil       â”‚ 1 â”‚
â”‚ fiddler-clickhouse-node-1.sd.spawar.navy.mil       â”‚ 1 â”‚
â”‚ france-production-clickhouse01.kameleoon.net       â”‚ 1 â”‚
â”‚ france-production-clickhouse02.kameleoon.net       â”‚ 1 â”‚
â”‚ france-production-clickhouse03.kameleoon.net       â”‚ 1 â”‚
â”‚ france-production-clickhouse04.kameleoon.net       â”‚ 1 â”‚
â”‚ france-production-clickhouse05.kameleoon.net       â”‚ 1 â”‚
â”‚ france-production-clickhouse06.kameleoon.net       â”‚ 1 â”‚
â”‚ fsn-clickhouse1.node.prerender.io                  â”‚ 1 â”‚
â”‚ graphite-clickhouse-01.cern.ch                     â”‚ 1 â”‚
â”‚ hitron-clickhouse.cloudcheck.net                   â”‚ 1 â”‚
â”‚ is-graph-clickhouse.i.smailru.net                  â”‚ 1 â”‚
â”‚ iva-clickhouse1.yamoney.ru                         â”‚ 1 â”‚
â”‚ iva-clickhouse2.yamoney.ru                         â”‚ 1 â”‚
â”‚ iva-clickhouse3.yamoney.ru                         â”‚ 1 â”‚
â”‚ lidl-production-clickhouse01.kameleoon.net         â”‚ 1 â”‚
â”‚ lidl-production-clickhouse02.kameleoon.net         â”‚ 1 â”‚
â”‚ load-clickhouse.nyc1.fontbundles.net               â”‚ 1 â”‚
â”‚ lsclickhouse1.gcore                                â”‚ 1 â”‚
â”‚ lsclickhouse2.gcore                                â”‚ 1 â”‚
â”‚ lsclickhouse3.gcore                                â”‚ 1 â”‚
â”‚ lsg-clickhouse.lbl.gov                             â”‚ 1 â”‚
â”‚ mclickhouse0.freenet.de                            â”‚ 1 â”‚
â”‚ mclickhouse1.freenet.de                            â”‚ 1 â”‚
â”‚ mclickhouse2.freenet.de                            â”‚ 1 â”‚
â”‚ nlrtm1-clickhouse01.sys.i3d.network                â”‚ 1 â”‚
â”‚ nlrtm1-clickhousecdn01d.sys.i3d.network            â”‚ 1 â”‚
â”‚ nlrtm1-clickhousecdn02d.sys.i3d.network            â”‚ 1 â”‚
â”‚ nlrtm1-clickhousecdn03d.sys.i3d.network            â”‚ 1 â”‚
â”‚ nlrtm1-clickhousecdn04d.sys.i3d.network            â”‚ 1 â”‚
â”‚ node01.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node02.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node03.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node03.dev.clickhouse.statistics.aatkit.com        â”‚ 1 â”‚
â”‚ node04.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node05.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node06.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node07.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node08.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node09.clickhouse.statistics.aatkit.com            â”‚ 1 â”‚
â”‚ node101.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node102.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node103.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node104.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node105.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node106.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node107.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node108.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node109.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node201.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node202.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node203.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node204.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node205.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node206.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node207.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node208.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ node209.clickhouse.statistics.aatkit.com           â”‚ 1 â”‚
â”‚ prod-us-clickhouse-01.jscrambler.com               â”‚ 1 â”‚
â”‚ product-recommendations-clickhouse01.kameleoon.net â”‚ 1 â”‚
â”‚ product-recommendations-clickhouse02.kameleoon.net â”‚ 1 â”‚
â”‚ production-clickhouse01.kameleoon.net              â”‚ 1 â”‚
â”‚ production-clickhouse02.kameleoon.net              â”‚ 1 â”‚
â”‚ production-clickhouse03.kameleoon.net              â”‚ 1 â”‚
â”‚ production-clickhouse04.kameleoon.net              â”‚ 1 â”‚
â”‚ production-clickhouse05.kameleoon.net              â”‚ 1 â”‚
â”‚ production-clickhouse06.kameleoon.net              â”‚ 1 â”‚
â”‚ projectx-clickhouse-nl-1.itsts.net                 â”‚ 1 â”‚
â”‚ pushhouse-clickhouse-1.t.push.house                â”‚ 1 â”‚
â”‚ pushhouse-clickhouse-2.t.push.house                â”‚ 1 â”‚
â”‚ pushhouse-clickhouse-3.t.push.house                â”‚ 1 â”‚
â”‚ pushhouse-clickhouse-4.t.push.house                â”‚ 1 â”‚
â”‚ pushhouse-clickhouse-5.t.push.house                â”‚ 1 â”‚
â”‚ pushhouse-clickhouse-6.t.push.house                â”‚ 1 â”‚
â”‚ rclickhouse1.gcore                                 â”‚ 1 â”‚
â”‚ ru-ihor-clickhouse-1.loc                           â”‚ 1 â”‚
â”‚ s04.servers.clickhouse.pepper.com                  â”‚ 1 â”‚
â”‚ s05.servers.clickhouse.pepper.com                  â”‚ 1 â”‚
â”‚ s06.servers.clickhouse.pepper.com                  â”‚ 1 â”‚
â”‚ s07.servers.clickhouse.pepper.com                  â”‚ 1 â”‚
â”‚ sds-clickhouse-01.pltrm.net                        â”‚ 1 â”‚
â”‚ sds-clickhouse-02.pltrm.net                        â”‚ 1 â”‚
â”‚ sds-clickhouse-03.pltrm.net                        â”‚ 1 â”‚
â”‚ sds-clickhouse-05.pltrm.net                        â”‚ 1 â”‚
â”‚ sds-clickhouse-06.pltrm.net                        â”‚ 1 â”‚
â”‚ sds-clickhouse-07.pltrm.net                        â”‚ 1 â”‚
â”‚ sm-clickhouse-prod-001.brq2.ff.avast.com           â”‚ 1 â”‚
â”‚ sm-clickhouse-prod-002.brq2.ff.avast.com           â”‚ 1 â”‚
â”‚ sm-clickhouse-prod-003.brq2.ff.avast.com           â”‚ 1 â”‚
â”‚ srv-clickhouse.infomatix.tech                      â”‚ 1 â”‚
â”‚ srv01.clickhouse.tonlabs.io                        â”‚ 1 â”‚
â”‚ steerfox-intg-clickhouse00.evolix.net              â”‚ 1 â”‚
â”‚ steerfox-pp-clickhouse00.evolix.net                â”‚ 1 â”‚
â”‚ steerfox-prod-clickhouse00.evolix.net              â”‚ 1 â”‚
â”‚ test-clickhouse01.kameleoon.net                    â”‚ 1 â”‚
â”‚ test-clickhouse02.kameleoon.net                    â”‚ 1 â”‚
â”‚ test-clickhouse03.kameleoon.net                    â”‚ 2 â”‚
â”‚ usa-production-clickhouse01.kameleoon.net          â”‚ 2 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜

307 rows in set. Elapsed: 4.130 sec. Processed 1.30 billion rows,
56.10 GB (314.15 million rows/s., 13.58 GB/s.)
</code></p>
</section>

<section class="slide">
<img style="width: 100%;" src="pictures/shodan.png"/>
</section>

<section class="slide">
<h2>Visualization</h2>
<p>I want nice pictures out of this dataset!</p>
<p>What to do?</p>
</section>

<section class="slide">
<p style="position: absolute; right: 3em; bottom: 1em; font-size: 10pt; color: gray;">2006, xkcd.com, CC BY-NC 2.5</p>
<p style="float: right; margin-top: 1em;">âŸµ I want something<br/>&emsp;&emsp;like this</p>
<img style="width: 62%;" src="pictures/xkcd.jpg"/>
</section>

<section class="slide">
<p style="float: right; margin-top: 1em;">âŸµ I want this<br/>&emsp;&nbsp;but bigger and better</p>
<p style="position: absolute; right: 3em; bottom: 1em; font-size: 10pt; color: gray;">2018, Ben Cartwright-Cox<br/><a href="https://blog.benjojo.co.uk/post/scan-ping-the-internet-hilbert-curve">https://blog.benjojo.co.uk/post/<br/>scan-ping-the-internet-hilbert-curve</a></p>
<img style="width: 65%;" src="pictures/benjojo.jpg"/>
</section>

<section class="slide">
<h2>Drawing a Picture With ClickHouse</h2>
<p><code style="font-size: 14pt; line-height: 1.25; margin-top: -0.5em;">(echo 'P3 4096 4096 255';
clickhouse client --host ... --query "
  WITH 4096 AS w, 4096 AS h, w * h AS pixels,
    cutToFirstSignificantSubdomain(domain) AS tld,
    sipHash64(tld) AS hash,
    <span style="color: red;">hash MOD 256 AS r,</span>
    <span style="color: green;">hash DIV 256 MOD 256 AS g,</span>
    <span style="color: blue;">hash DIV 65536 MOD 256 AS b,</span>
    toUInt32(ip) AS num,
    num DIV (0x100000000 DIV pixels) AS idx,
    mortonDecode(2, idx) AS coord
  SELECT avg(r)::UInt8, avg(g)::UInt8, avg(b)::UInt8
  FROM dns_parsed GROUP BY coord
  ORDER BY coord.2 * w + coord.1
    WITH FILL FROM 0 TO 4096*4096
" --progress
) | pnmtopng > image.png
</code></p>
</section>

<section class="slide" style="background: url(pictures/map1.png) no-repeat black; background-size: contain; background-position: center;">
</section>

<section class="slide" style="background: url(pictures/map1.png) no-repeat black; background-size: cover; background-position: center;">
</section>

<section class="slide">
<h2>Visualization</h2>
<p>So what?</p>
<p>It is just 4K resolution.</p>
<p>I want a full picture of 4 gigapixel, 65536â¨¯65536!</p>

<p style="color: gray; margin-top: 2em;">It works &mdash; we can generate 4 gigapixel picture straight away.</p>
<p style="color: gray;">But the picture does not open in many viewers.</p>
</section>

<section class="slide">
<h2>Solution: Tiles</h2>
<img style="float: right; width: 30%; margin-right: -3em;" src="pictures/javascript.webp"/>
<p>Let's represent a giant picture in the same way<br/>as Google Maps &mdash; as a set of tiles.</p>
<p>And make a web page that will load the tiles on demand.</p>

<p>But now we have to use JavaScript...</p>

<p>Libraries for viewing large images:
<br/>&mdash; Leaflet: <a href="https://leafletjs.com/">https://leafletjs.com/</a>
<br/>&mdash; OpenSeaDragon: <a href="https://openseadragon.github.io/">https://openseadragon.github.io/</a></p>
</section>

<section class="slide">
<h2>Tiles</h2>
<p><code style="font-size: 14pt; line-height: 1.25;">0-0-0.png  1-0-0.png  1-0-1.png  1-1-0.png  1-1-1.png  2-0-0.png
2-0-1.png  2-0-2.png  2-0-3.png  2-1-0.png  2-1-1.png  2-1-2.png
2-1-3.png  2-2-0.png  2-2-1.png  2-2-2.png  2-2-3.png  2-3-0.png
2-3-1.png  2-3-2.png  2-3-3.png  3-0-0.png  3-0-1.png  3-0-2.png
3-0-3.png  3-0-4.png  3-0-5.png  3-0-6.png  3-0-7.png  3-1-0.png
3-1-1.png  3-1-2.png  3-1-3.png  3-1-4.png  3-1-5.png  3-1-6.png
3-1-7.png  3-2-0.png  3-2-1.png  3-2-2.png  3-2-3.png  3-2-4.png
3-2-5.png  3-2-6.png  3-2-7.png  3-3-0.png  3-3-1.png  3-3-2.png
3-3-3.png  3-3-4.png  3-3-5.png  3-3-6.png  3-3-7.png  3-4-0.png
3-4-1.png  3-4-2.png  3-4-3.png  3-4-4.png  3-4-5.png  3-4-6.png
3-4-7.png  3-5-0.png  3-5-1.png  3-5-2.png  3-5-3.png  3-5-4.png
...
</code></p>
<p>{zoom}-{x}-{y}.png</p>
</section>

<section class="slide">
<h2>Tiles</h2>
<p><code style="font-size: 14pt; line-height: 1.25; margin-top: -1em; height: 23em; overflow-y: scroll;">for zoom in {0..6}
do
  num_tiles=$((2**zoom))
  for tile_x in $(seq 0 $(($num_tiles - 1)))
  do
    for tile_y in $(seq 0 $(($num_tiles - 1)))
    do
      filename="tiles/${zoom}-${tile_x}-${tile_y}.png"
      echo $filename

      [ -s "$filename" ] ||
      (
        echo 'P3 1024 1024 255';
        clickhouse client --host driel7jwie.eu-west-1.aws.clickhouse-staging.com --secure --password "$PASSWORD" --query "
          WITH 1024 AS w, 1024 AS h, w * h AS pixels,
            cutToFirstSignificantSubdomain(domain) AS tld,
            sipHash64(tld) AS hash,
            hash MOD 256 AS r, hash DIV 256 MOD 256 AS g, hash DIV 65536 MOD 256 AS b,
            toUInt32(ip) AS num,

            mortonDecode(2, num) AS src_coord,

            bitShiftRight(65536, ${zoom}) AS crop_size,
            ${tile_x} * crop_size AS left,
            ${tile_y} * crop_size AS top,
            left + crop_size AS right,
            top + crop_size AS bottom,

            (src_coord.1 >= left AND src_coord.1 < right) AND (src_coord.2 >= top AND src_coord.2 &lt; bottom) AS in_tile,

            (src_coord.1 - left) DIV (crop_size DIV w) AS x,
            (src_coord.2 - top)  DIV (crop_size DIV h) AS y

          SELECT avg(r)::UInt8, avg(g)::UInt8, avg(b)::UInt8
          FROM dns_parsed
          WHERE in_tile
          GROUP BY x, y
          ORDER BY y * w + x WITH FILL FROM 0 TO 1024*1024
        " --progress
      ) | pnmtopng > $filename

    done
  done
done
</code></p>
</section>

<section class="slide" style="background: url(pictures/tiles.png) no-repeat black; background-size: cover; background-position: center;">
</section>

<section class="slide">
<h2>ReverseDNS.space</h2>
<p><a href="https://reversedns.space/">https://reversedns.space/</a> âŸµ click here</p>
</section>

<section class="slide">
<h2>ReverseDNS.space</h2>
<p>Every click generates an SQL query to ClickHouse:</p>
<p><code style="font-size: 12pt; line-height: 1.5;">const response = fetch(
    `https://driel7jwie.eu-west-1.aws.clickhouse-staging.com/?user=website`,
    {
        method: 'POST',
        body: `<b>SELECT domain FROM dns_parsed WHERE ip = '${ip_str}' FORMAT JSON</b>`
    }).then(response => response.json().then(o => {

        let host = o.rows ? o.data[0].domain : 'no response';

        if (ip_str == current_requested_ip) {
            popup.setContent(`&lt;b>${ip_str}&lt;/b>&lt;br/>${host}`);
        }
    }));
</code></p>
</section>

<section class="slide">
<h2>ReverseDNS.space</h2>
<p>Don't forget to set up users and quotas:</p>
<p><code style="font-size: 12pt; line-height: 1.4;">CREATE USER website IDENTIFIED WITH ...
SETTINGS
    add_http_cors_header = 1 READONLY,
    limit = 1 READONLY,
    offset = 0 READONLY,
    max_result_rows = 1 READONLY

GRANT SELECT ON default.dns_parsed TO website;

CREATE QUOTA website
    KEYED BY ip_address
    FOR RANDOMIZED INTERVAL 1 MINUTE MAX query_selects = 100,
    FOR RANDOMIZED INTERVAL 1 HOUR MAX query_selects = 3000,
    FOR RANDOMIZED INTERVAL 1 DAY MAX query_selects = 30000
    TO website;
</code></p>
</section>

<section class="slide">
<div style="float: right; width: 30%;">
    <video style="margin-right: 1em;"><source src="pictures/fun.mp4" type="video/mp4"></video>
    <p style="font-size: 10pt; color: gray;">Source: Eh Bee Family, 2014, https://vine.co/v/OwTOez0W6wg</p>
</div>
<h2>Takeaways</h2>
<p>Don't be afraid &mdash; you can use ClickHouse<br/>for everything.</p>
<p>You will find something new in the process.</p>
<p>Maybe you fill find a creative way to break something.</p>

<p style="margin-top: 3em;">Source code: <a href="https://github.com/ClickHouse/reversedns.space/">https://github.com/ClickHouse/reversedns.space/</a></p>
</section>

<section class="slide" style="background: url(pictures/final.jpg); background-size: cover; background-position: center;">
<h2><span class="hilite">Q&amp;A</a></h2>
</section>


    <div class="progress"></div>
    <script src="https://presentations.clickhouse.com/shower/shower.js"></script>

    <!--Video plugin-->
    <link rel="stylesheet" href="https://presentations.clickhouse.com/shower/shower-video.css">
    <script src="https://presentations.clickhouse.com/shower/shower-video.js"></script>
    <!--/Video plugin-->
<footer class="badge">
    <a href="https://presentations.clickhouse.com/">ClickHouse Theater</a>
</footer>
</body>
</html>

